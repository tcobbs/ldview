#!/bin/sh
if [ -f /etc/lsb-release ] ; then
. /etc/lsb-release
fi
if [ -n "$DISTRIB_ID" ] ; then
	DIST=`echo $DISTRIB_ID|tr '[:upper:]' '[:lower:]'`-$DISTRIB_RELEASE.
else
	if lsb_release -i |grep -q : ; then
		DIST=`lsb_release -is|tr '[:upper:]' '[:lower:]'`-`lsb_release -sc`.
	fi
fi
if (echo  $PATH | grep -q ccache ) ; then
	true
else
	export PATH=/usr/lib/ccache:$PATH
fi
test -f LDView.pro && cd ..
rm -f ../ldview*.dsc ../ldview*.deb QT/ldview*.deb
ldvdir=`pwd`
cd ..
if [ -d LDView ] ; then ldvdir=LDView ; 
elif [ -d ldview ] ; then ldvdir=ldview ; 
elif [ -f project/QT/LDView.pro ] ; then ldvdir=project ; fi
QT_VER=`QT_SELECT=5 qmake -query | grep QT_VERSION | cut -d: -f2|cut -d. -f1`
cp -rf $ldvdir/QT/debian $ldvdir/
cd $ldvdir
dpkg-buildpackage || exit 1
rm -rf debian
cd ..
for f in ldview_*.deb ldview-osmesa_*.deb ldview-qt5_*.deb ; do
	cp -f $f $ldvdir/QT/$(echo $f|sed -E "s/^(.*)_([^_]*)$/\1-${DIST}\2/")
done
ls -l $ldvdir/QT/ldview*.deb
if [ -d /mnt/lego ] ; then
	cp -f $ldvdir/QT/ldview*.deb /mnt/lego/
fi
